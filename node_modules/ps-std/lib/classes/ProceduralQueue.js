'use strict';
var __importDefault =
	(this && this.__importDefault) ||
	function (mod) {
		return mod && mod.__esModule ? mod : { default: mod };
	};
Object.defineProperty(exports, '__esModule', { value: true });
exports.ProceduralQueue = void 0;
const SerialQueue_1 = __importDefault(require('./SerialQueue'));
class ProceduralQueue {
	constructor(callback, error_handler, thisArg = {}) {
		this._callback = callback;
		this._queue = new SerialQueue_1.default((err) => {
			if (error_handler) {
				error_handler(err);
			} else {
				throw err;
			}
		});
		this._thisArg = thisArg;
	}
	await(...args) {
		return new Promise((resolve) => {
			this._queue.add(async () =>
				resolve({
					args,
					output: await this._callback.apply(this._thisArg, args),
				})
			);
		});
	}
	add(...tasks) {
		for (const task of tasks) {
			this.await(...task);
		}
	}
}
exports.ProceduralQueue = ProceduralQueue;
exports.default = ProceduralQueue;
Object.defineProperties(ProceduralQueue, {
	default: { get: () => ProceduralQueue },
	ProceduralQueue: { get: () => ProceduralQueue },
});
