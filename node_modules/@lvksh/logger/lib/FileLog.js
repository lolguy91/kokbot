"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.FileLogger = void 0;
const fs_1 = require("fs");
const path_1 = require("path");
const ansi_1 = require("./ansi");
const FileLogger = (config) => {
    let path = config.path;
    // If we are creating a new file generate the file name
    if (config.mode == 'NEW_FILE') {
        let calculatedPattern = config.namePattern;
        path = (0, path_1.join)(config.path, calculatedPattern);
    }
    // Ensure the parent folder exists
    const folder = (0, path_1.resolve)(path, '..');
    if (!(0, fs_1.existsSync)(folder)) {
        (0, fs_1.mkdirSync)(folder, { recursive: true });
    }
    // Create the stream to write out to
    const stream = (0, fs_1.createWriteStream)(path, {
        encoding: 'utf-8',
        autoClose: true,
    });
    // Return the executable logging function
    return (input) => {
        stream.write((0, ansi_1.stripAnsi)(input) + '\n');
    };
};
exports.FileLogger = FileLogger;
